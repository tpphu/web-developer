<?xml version="1.0"?>
<project name="web-developer" default="build">
	<!-- Custom tasks -->
  <taskdef name="jshint" classname="com.philmander.jshint.JsHintAntTask" classpath="ant-jshint.jar" />
	<taskdef name="jslint" classname="com.googlecode.jslint4java.ant.JSLintTask" classpath="jslint4java.jar"/>
	<taskdef resource="net/sf/antcontrib/antlib.xml" classpath="ant-contrib.jar"/>

  <!-- Main targets -->
  <target name="all" depends="build,package,test" description="Builds, packages and tests the extension"/>
  <target name="build" depends="build.chrome,build.opera,package.firefox" description="Builds the extension"/>
	<target name="chrome" depends="build.chrome" description="Builds the extension for Chrome"/>
  <target name="clean" depends="clean.chrome,clean.firefox,clean.opera" description="Cleans up the build"/>
	<target name="firefox" depends="package.firefox" description="Builds the extension for Firefox"/>
  <target name="opera" depends="build.opera" description="Builds the extension for Opera"/>
	<target name="package" depends="package.chrome,package.firefox,package.opera" description="Packages the extension"/>
  <target name="test" depends="jshint,jslint" description="Tests the extension"/>

  <!-- Build targets -->
  <target name="build.chrome" depends="initialize.chrome,clean.chrome">
    <antcall target="build.chrome.configuration" inheritRefs="true"/>
    <antcall target="build.chrome.about" inheritRefs="true"/>
    <antcall target="build.chrome.background" inheritRefs="true"/>
    <antcall target="build.chrome.common" inheritRefs="true"/>
    <antcall target="build.chrome.content" inheritRefs="true"/>
    <antcall target="build.chrome.dashboard" inheritRefs="true"/>
    <antcall target="build.chrome.features" inheritRefs="true"/>
    <antcall target="build.chrome.generated" inheritRefs="true"/>
    <antcall target="build.chrome.locales" inheritRefs="true"/>
    <antcall target="build.chrome.options" inheritRefs="true"/>
    <antcall target="build.chrome.overlay" inheritRefs="true"/>
    <antcall target="build.chrome.toolbars" inheritRefs="true"/>
  </target>

  <target name="build.firefox" depends="initialize.firefox,clean.firefox">
    <antcall target="build.firefox.configuration" inheritRefs="true"/>
    <antcall target="build.firefox.about" inheritRefs="true"/>
    <antcall target="build.firefox.common" inheritRefs="true"/>
    <antcall target="build.firefox.content" inheritRefs="true"/>
    <antcall target="build.firefox.dashboard" inheritRefs="true"/>
    <antcall target="build.firefox.dialogs" inheritRefs="true"/>
    <antcall target="build.firefox.features" inheritRefs="true"/>
    <antcall target="build.firefox.generated" inheritRefs="true"/>
    <antcall target="build.firefox.locales" inheritRefs="true"/>
    <antcall target="build.firefox.options" inheritRefs="true"/>
    <antcall target="build.firefox.overlay" inheritRefs="true"/>
    <antcall target="build.firefox.skins" inheritRefs="true"/>
    <antcall target="build.firefox.toolbars" inheritRefs="true"/>
  </target>

  <target name="build.opera" depends="initialize.opera,clean.opera">
    <antcall target="build.opera.configuration" inheritRefs="true"/>
    <antcall target="build.chrome.about" inheritRefs="true"/>
    <antcall target="build.chrome.background" inheritRefs="true"/>
    <antcall target="build.chrome.common" inheritRefs="true"/>
    <antcall target="build.chrome.content" inheritRefs="true"/>
    <antcall target="build.chrome.dashboard" inheritRefs="true"/>
    <antcall target="build.chrome.features" inheritRefs="true"/>
    <antcall target="build.chrome.generated" inheritRefs="true"/>
    <antcall target="build.chrome.locales" inheritRefs="true"/>
    <antcall target="build.chrome.options" inheritRefs="true"/>
    <antcall target="build.chrome.overlay" inheritRefs="true"/>
    <antcall target="build.chrome.toolbars" inheritRefs="true"/>
  </target>

  <!-- Builds the about page for Chrome -->
  <target name="build.chrome.about">
    <echo level="info" message="Building the about page"/>
    <copy file="../source/common/html/about/about.html" tofile="${browser}/about/about.html">
      <filterset refid="filters"/>
    </copy>
    <copy file="../source/common/javascript/about/about.js" tofile="${browser}/about/javascript/about.js"/>
    <copy file="../source/common/style-sheets/about/about.css" tofile="${browser}/about/about.css">
      <filterset refid="filters"/>
    </copy>
  </target>

  <!-- Builds the background page for Chrome -->
  <target name="build.chrome.background">
    <echo level="info" message="Building the background page"/>
    <copy file="../source/chrome/html/background/background.html" tofile="${browser}/background/background.html">
      <filterset refid="filters"/>
    </copy>
    <copy file="../source/chrome/javascript/background/background.js" tofile="${browser}/background/javascript/background.js"/>
  </target>

  <!-- Builds the common files for Chrome -->
  <target name="build.chrome.common">
    <echo level="info" message="Building the common files"/>
    <copy todir="${browser}/common/javascript/bootstrap">
      <fileset dir="../source/common/javascript/common/bootstrap"/>
    </copy>
    <copy todir="${browser}/common/javascript/codemirror">
      <fileset dir="../source/common/javascript/common/codemirror"/>
    </copy>
    <copy todir="${browser}/common/javascript/jquery">
      <fileset dir="../source/common/javascript/common/jquery"/>
      <fileset dir="../source/chrome/javascript/common/jquery"/>
    </copy>
    <concat destfile="${browser}/common/javascript/common.js">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/chrome/javascript/common/common.js"/>
    </concat>
    <copy file="../source/common/javascript/common/css.js" tofile="${browser}/common/javascript/css.js"/>
    <concat destfile="${browser}/cookies/cookies.js">
      <fileset file="../source/common/javascript/cookies/cookies.js"/>
      <fileset file="../source/chrome/javascript/cookies/cookies.js"/>
    </concat>
    <concat destfile="${browser}/locales/locales.js">
      <fileset file="../source/common/javascript/locales/locales.js"/>
      <fileset file="../source/chrome/javascript/locales/locales.js"/>
    </concat>
    <concat destfile="${browser}/storage/storage.temp">
      <fileset file="../source/common/javascript/storage/storage.js"/>
      <fileset file="../source/chrome/javascript/storage/storage.js"/>
    </concat>
    <move file="${browser}/storage/storage.temp" tofile="${browser}/storage/storage.js">
      <filterset refid="filters"/>
    </move>
    <concat destfile="${browser}/upgrade/upgrade.temp">
      <fileset file="../source/common/javascript/upgrade/upgrade.js"/>
      <fileset file="../source/chrome/javascript/upgrade/upgrade.js"/>
    </concat>
    <move file="${browser}/upgrade/upgrade.temp" tofile="${browser}/upgrade/upgrade.js">
      <filterset refid="filters"/>
    </move>
    <concat destfile="${browser}/common/style-sheets/bootstrap.css">
      <fileset file="../source/common/style-sheets/common/bootstrap/bootstrap.css"/>
      <fileset file="../source/common/style-sheets/common/bootstrap/font-awesome.css"/>
    </concat>
    <replace file="${browser}/common/style-sheets/bootstrap.css" token="fonts/fontawesome-webfont" value="../fonts/fontawesome-webfont"/>
    <copy file="../source/common/style-sheets/generated/common.css" tofile="${browser}/common/style-sheets/generated.css">
      <filterset refid="filters"/>
    </copy>
    <concat destfile="${browser}/common/style-sheets/syntax-highlight.css">
      <fileset file="../source/common/style-sheets/common/codemirror/codemirror.css"/>
      <fileset file="../source/common/style-sheets/common/codemirror/theme.css"/>
    </concat>
    <copy file="../images/common/logos/favicon.ico" tofile="${browser}/common/images/logos/favicon.ico"/>
    <copy file="../images/common/logos/16.png" tofile="${browser}/common/images/logos/16.png"/>
    <copy file="../images/common/logos/32.png" tofile="${browser}/common/images/logos/32.png"/>
    <copy file="../images/common/logos/48.png" tofile="${browser}/common/images/logos/48.png"/>
    <copy file="../images/common/logos/64.png" tofile="${browser}/common/images/logos/64.png"/>
    <copy file="../images/common/logos/128.png" tofile="${browser}/common/images/logos/128.png"/>
    <copy todir="${browser}/common/fonts">
      <fileset dir="../source/common/fonts"/>
    </copy>
  </target>

  <!-- Builds the configuration for Chrome -->
  <target name="build.chrome.configuration">
    <echo level="info" message="Building the configuration"/>
    <copy file="../configuration/chrome/manifest.json" tofile="chrome/manifest.json">
      <filterset refid="filters"/>
    </copy>
  </target>

  <!-- Builds the content JavaScript for Chrome -->
  <target name="build.chrome.content">
    <echo level="info" message="Building the content JavaScript"/>
    <concat destfile="${browser}/content/content.js">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/chrome/javascript/common/common.js"/>
      <fileset file="../source/common/javascript/common/css.js"/>
      <fileset file="../source/common/javascript/content/content.js"/>
      <fileset file="../source/chrome/javascript/content/content.js"/>
    </concat>
  </target>

  <!-- Builds the dashboard for Chrome -->
  <target name="build.chrome.dashboard">
    <echo level="info" message="Building the dashboard"/>
    <concat destfile="${browser}/dashboard/javascript/html/dashboard.js">
      <fileset file="../source/common/javascript/toolbar/html/element-ancestors.js"/>
      <fileset file="../source/chrome/javascript/dashboard/common.js"/>
    </concat>
    <concat destfile="${browser}/dashboard/javascript/dashboard.temp">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/chrome/javascript/common/common.js"/>
      <fileset file="../source/common/javascript/dashboard/dashboard.js"/>
      <fileset file="../source/chrome/javascript/dashboard/dashboard.js"/>
      <fileset file="../source/common/javascript/dashboard/element-information.js"/>
      <fileset file="../source/chrome/javascript/dashboard/element-information.js"/>
      <fileset file="../source/common/javascript/dashboard/edit-css.js"/>
      <fileset file="../source/chrome/javascript/dashboard/edit-css.js"/>
      <fileset file="../source/common/javascript/toolbar/element-ancestors.js"/>
      <fileset file="../source/chrome/javascript/toolbar/element-ancestors.js"/>
    </concat>
    <move file="${browser}/dashboard/javascript/dashboard.temp" tofile="${browser}/dashboard/javascript/dashboard.js">
      <filterset refid="filters"/>
    </move>
    <copy file="../source/chrome/style-sheets/dashboard/dashboard.css" tofile="${browser}/dashboard/style-sheets/dashboard.css"/>
    <concat destfile="${browser}/dashboard/style-sheets/common.temp">
      <fileset file="../source/common/style-sheets/common/bootstrap/bootstrap.css"/>
      <fileset file="../source/common/style-sheets/dashboard/common.css"/>
      <fileset file="../source/common/style-sheets/dashboard/element-information.css"/>
      <fileset file="../source/chrome/style-sheets/dashboard/common.css"/>
    </concat>
    <move file="${browser}/dashboard/style-sheets/common.temp" tofile="${browser}/dashboard/style-sheets/common.css">
      <filterset refid="filters"/>
    </move>
    <copy file="../images/common/logos/monochrome/16.png" tofile="${browser}/dashboard/images/logo.png"/>
  </target>

  <!-- Builds the features for Chrome -->
  <target name="build.chrome.features">
    <echo level="info" message="Building the features"/>
    <concat destfile="${browser}/features/javascript/css.js">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/chrome/javascript/features/common.js"/>
      <fileset file="../source/common/javascript/common/css.js"/>
      <fileset file="../source/common/javascript/features/css.js"/>
    </concat>
    <concat destfile="${browser}/features/javascript/forms.temp">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/chrome/javascript/features/common.js"/>
      <fileset file="../source/common/javascript/features/forms.js"/>
    </concat>
    <move file="${browser}/features/javascript/forms.temp" tofile="${browser}/features/javascript/forms.js">
      <filterset refid="filters"/>
    </move>
    <concat destfile="${browser}/features/javascript/images.js">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/chrome/javascript/features/common.js"/>
      <fileset file="../source/common/javascript/features/images.js"/>
    </concat>
    <concat destfile="${browser}/features/javascript/information.js">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/chrome/javascript/features/common.js"/>
      <fileset file="../source/common/javascript/features/information.js"/>
    </concat>
    <concat destfile="${browser}/features/javascript/facebook.js">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/chrome/javascript/features/common.js"/>
      <fileset file="../source/common/javascript/features/facebook.js"/>
    </concat>
    <concat destfile="${browser}/features/javascript/miscellaneous.js">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/chrome/javascript/features/common.js"/>
      <fileset file="../source/common/javascript/features/miscellaneous.js"/>
    </concat>
    <concat destfile="${browser}/features/javascript/outline.js">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/chrome/javascript/features/common.js"/>
      <fileset file="../source/common/javascript/features/outline.js"/>
    </concat>
    <copy todir="${browser}/features/style-sheets">
      <fileset dir="../source/common/style-sheets/features"/>
    </copy>
    <copy file="../source/common/style-sheets/common/reset.css" tofile="${browser}/features/style-sheets/css/disable-browser-default-styles.css"/>
    <copy file="../images/common/transparent.png" tofile="${browser}/features/style-sheets/images/transparent.png"/>

    <echo level="info" message="Building the validation features"/>
    <copy todir="${browser}/validation">
      <fileset dir="../source/chrome/html/validation"/>
      <filterset refid="filters"/>
    </copy>
    <copy todir="${browser}/validation/javascript">
      <fileset dir="../source/chrome/javascript/validation"/>
    </copy>
  </target>

  <!-- Builds the generated pages for Chrome -->
  <target name="build.chrome.generated">
    <echo level="info" message="Building the generated pages"/>
    <copy todir="${browser}/generated">
      <fileset dir="../source/common/html/generated"/>
      <fileset dir="../source/common/style-sheets/generated">
        <exclude name="common.css"/>
      </fileset>
      <filterset refid="filters"/>
    </copy>
    <copy file="../source/common/javascript/generated/beautify/beautify.js" tofile="${browser}/generated/javascript/beautify/beautify.js"/>
    <copy todir="${browser}/generated/javascript">
      <fileset dir="../source/common/javascript/generated"/>
    </copy>
  </target>

  <!-- Builds the locales for Chrome -->
  <target name="build.chrome.locales">
    <echo level="info" message="Building the locales"/>
    <copy todir="${browser}/_locales">
      <fileset dir="../source/chrome/locales"/>
      <filterset refid="filters"/>
    </copy>
  </target>

  <!-- Builds the options for Chrome -->
  <target name="build.chrome.options">
    <echo level="info" message="Building the options"/>
    <copy todir="${browser}/options">
      <fileset file="../source/common/html/options/syntax-highlight.html"/>
      <fileset file="../source/chrome/html/options/options.html"/>
      <filterset refid="filters"/>
    </copy>
    <copy file="../source/chrome/javascript/options/options.js" tofile="${browser}/options/javascript/options.js"/>
    <copy file="../source/common/javascript/options/syntax-highlight.js" tofile="${browser}/options/javascript/syntax-highlight.js"/>
    <copy file="../source/chrome/style-sheets/options/options.css" tofile="${browser}/options/options.css">
      <filterset refid="filters"/>
    </copy>
    <copy file="../source/common/style-sheets/options/syntax-highlight.css" tofile="${browser}/options/syntax-highlight.css"/>
    <copy file="../images/chrome/options.png" tofile="${browser}/options/images/options.png"/>
    <copy file="../images/chrome/options-2x.png" tofile="${browser}/options/images/options-2x.png"/>
  </target>

  <!-- Builds the overlay for Chrome -->
  <target name="build.chrome.overlay">
    <echo level="info" message="Building the overlay"/>
    <copy file="../source/chrome/html/overlay/overlay.html" tofile="${browser}/overlay/overlay.html">
      <filterset refid="filters"/>
    </copy>
    <concat destfile="${browser}/overlay/javascript/overlay.js">
      <fileset dir="../source/common/javascript/overlay"/>
      <fileset file="../source/chrome/javascript/overlay/overlay.js"/>
      <fileset dir="../source/chrome/javascript/overlay">
        <exclude name="overlay.js"/>
      </fileset>
    </concat>
    <copy file="../source/chrome/style-sheets/overlay/overlay.css" tofile="${browser}/overlay/overlay.css"/>
    <copy file="../images/common/toolbar.png" tofile="${browser}/overlay/images/toolbar.png"/>
    <copy file="../images/common/toolbar-2x.png" tofile="${browser}/overlay/images/toolbar-2x.png"/>
    <copy file="../images/chrome/feature.png" tofile="${browser}/overlay/images/feature.png"/>
    <copy file="../images/chrome/feature-2x.png" tofile="${browser}/overlay/images/feature-2x.png"/>
    <copy file="../images/chrome/icon.png" tofile="${browser}/overlay/images/icon.png"/>
    <copy file="../images/chrome/icon-2x.png" tofile="${browser}/overlay/images/icon-2x.png"/>
    <copy file="../images/chrome/icon-color.png" tofile="${browser}/overlay/images/icon-color.png"/>
    <copy file="../images/chrome/icon-color-2x.png" tofile="${browser}/overlay/images/icon-color-2x.png"/>
  </target>

  <!-- Builds the toolbars for Chrome -->
  <target name="build.chrome.toolbars">
    <echo level="info" message="Building the toolbars"/>
    <copy file="../source/chrome/javascript/toolbar/color-picker.js" tofile="${browser}/toolbar/javascript/color-picker.js">
      <filterset refid="filters"/>
    </copy>
    <concat destfile="${browser}/toolbar/javascript/line-guides.js">
      <fileset file="../source/common/javascript/toolbar/line-guides.js"/>
      <fileset file="../source/chrome/javascript/toolbar/line-guides.js"/>
    </concat>
    <concat destfile="${browser}/toolbar/javascript/ruler.js">
      <fileset file="../source/common/javascript/toolbar/ruler.js"/>
      <fileset file="../source/chrome/javascript/toolbar/ruler.js"/>
    </concat>
    <concat destfile="${browser}/toolbar/color-picker.css">
      <fileset file="../source/chrome/style-sheets/toolbar/toolbar.css"/>
      <fileset file="../source/chrome/style-sheets/toolbar/color-picker.css"/>
    </concat>
    <concat destfile="${browser}/toolbar/color-picker-toolbar.css">
      <fileset file="../source/common/style-sheets/common/bootstrap/bootstrap.css"/>
      <fileset file="../source/common/style-sheets/common/common.css"/>
      <fileset file="../source/chrome/style-sheets/toolbar/common.css"/>
      <fileset file="../source/chrome/style-sheets/toolbar/color-picker-toolbar.css"/>
    </concat>
    <copy file="../source/common/style-sheets/toolbar/element-ancestors.css" tofile="${browser}/toolbar/element-ancestors.css"/>
    <concat destfile="${browser}/toolbar/element-information.css">
      <fileset file="../source/chrome/style-sheets/toolbar/toolbar.css"/>
      <fileset file="../source/common/style-sheets/toolbar/element-information.css"/>
      <fileset file="../source/chrome/style-sheets/toolbar/element-information.css"/>
    </concat>
    <concat destfile="${browser}/toolbar/line-guides.css">
      <fileset file="../source/chrome/style-sheets/toolbar/toolbar.css"/>
      <fileset file="../source/common/style-sheets/toolbar/line-guides.css"/>
    </concat>
    <concat destfile="${browser}/toolbar/line-guides-toolbar.css">
      <fileset file="../source/common/style-sheets/common/bootstrap/bootstrap.css"/>
      <fileset file="../source/common/style-sheets/common/common.css"/>
      <fileset file="../source/chrome/style-sheets/toolbar/common.css"/>
      <fileset file="../source/chrome/style-sheets/toolbar/line-guides.css"/>
    </concat>
    <concat destfile="${browser}/toolbar/ruler.css">
      <fileset file="../source/chrome/style-sheets/toolbar/toolbar.css"/>
      <fileset file="../source/common/style-sheets/toolbar/ruler.css"/>
    </concat>
    <concat destfile="${browser}/toolbar/ruler-toolbar.css">
      <fileset file="../source/common/style-sheets/common/bootstrap/bootstrap.css"/>
      <fileset file="../source/common/style-sheets/common/common.css"/>
      <fileset file="../source/chrome/style-sheets/toolbar/common.css"/>
      <fileset file="../source/chrome/style-sheets/toolbar/ruler.css"/>
    </concat>
    <copy file="../images/common/logos/monochrome/16.png" tofile="${browser}/toolbar/images/logo.png"/>
  </target>

  <!-- Builds the about page for Firefox -->
  <target name="build.firefox.about">
    <echo level="info" message="Building the about page"/>
    <copy file="../source/common/html/about/about.html" tofile="firefox/content/web-developer/about/about.html">
      <filterset refid="filters"/>
    </copy>
    <concat destfile="firefox/content/web-developer/about/javascript/about.js">
    	<fileset file="../source/common/javascript/generated/common.js"/>
    	<fileset file="../source/common/javascript/about/about.js"/>
    </concat>
    <copy file="../source/common/style-sheets/about/about.css" tofile="firefox/content/web-developer/about/about.css">
      <filterset refid="filters"/>
    </copy>
	</target>

  <!-- Builds the common JavaScript for Firefox -->
  <target name="build.firefox.common">
    <echo level="info" message="Building the common files"/>
    <copy todir="firefox/content/web-developer/common/javascript/bootstrap">
      <fileset dir="../source/common/javascript/common/bootstrap"/>
    </copy>
    <copy todir="firefox/content/web-developer/common/javascript/codemirror">
      <fileset dir="../source/common/javascript/common/codemirror"/>
    </copy>
    <copy todir="firefox/content/web-developer/common/javascript/jquery">
      <fileset dir="../source/common/javascript/common/jquery"/>
    </copy>
    <concat destfile="firefox/content/web-developer/common/javascript/common.js">
    	<fileset file="../source/common/javascript/common/common.js"/>
    	<fileset file="../source/firefox/javascript/common/common.js"/>
    </concat>
    <concat destfile="firefox/content/web-developer/cookies/cookies.js">
      <fileset file="../source/common/javascript/cookies/cookies.js"/>
      <fileset file="../source/firefox/javascript/cookies/cookies.js"/>
    </concat>
    <concat destfile="firefox/content/web-developer/locales/locales.js">
      <fileset file="../source/common/javascript/locales/locales.js"/>
      <fileset file="../source/firefox/javascript/locales/locales.js"/>
    </concat>
    <copy file="../source/firefox/javascript/preferences/defaults.js" tofile="firefox/defaults/preferences/defaults.js"/>
    <copy file="../source/firefox/javascript/preferences/preferences.js" tofile="firefox/content/web-developer/preferences/preferences.js"/>
    <concat destfile="firefox/content/web-developer/storage/storage.js">
    	<fileset file="../source/common/javascript/storage/storage.js"/>
    	<fileset file="../source/firefox/javascript/storage/storage.js"/>
    </concat>
    <concat destfile="firefox/content/web-developer/toolbar/javascript/element-ancestors.js">
    	<fileset file="../source/common/javascript/toolbar/element-ancestors.js"/>
    	<fileset file="../source/firefox/javascript/toolbar/element-ancestors.js"/>
    </concat>
    <concat destfile="firefox/content/web-developer/common/style-sheets/bootstrap.css">
      <fileset file="../source/common/style-sheets/common/bootstrap/bootstrap.css"/>
      <fileset file="../source/common/style-sheets/common/bootstrap/font-awesome.css"/>
    </concat>
    <replace file="firefox/content/web-developer/common/style-sheets/bootstrap.css" token="fonts/fontawesome-webfont" value="../fonts/fontawesome-webfont"/>
    <copy file="../source/common/style-sheets/generated/common.css" tofile="firefox/content/web-developer/common/style-sheets/generated.css">
      <filterset refid="filters"/>
    </copy>
    <concat destfile="firefox/content/web-developer/common/style-sheets/syntax-highlight.css">
      <fileset file="../source/common/style-sheets/common/codemirror/codemirror.css"/>
      <fileset file="../source/common/style-sheets/common/codemirror/theme.css"/>
    </concat>
    <copy file="../images/common/logos/favicon.ico" tofile="firefox/content/web-developer/common/images/logos/favicon.ico"/>
    <copy file="../images/common/logos/16.png" tofile="firefox/content/web-developer/common/images/logos/16.png"/>
    <copy file="../images/common/logos/48.png" tofile="firefox/content/web-developer/common/images/logos/48.png"/>
    <copy file="../images/common/logos/64.png" tofile="firefox/content/web-developer/common/images/logos/64.png"/>
    <copy file="../images/common/logos/128.png" tofile="firefox/content/web-developer/common/images/logos/128.png"/>
    <copy todir="firefox/content/web-developer/common/fonts">
      <fileset dir="../source/common/fonts"/>
    </copy>
	</target>

  <!-- Builds the configuration for Firefox -->
  <target name="build.firefox.configuration">
    <echo level="info" message="Building the configuration"/>
    <copy todir="firefox">
      <fileset file="../configuration/firefox/chrome.manifest"/>
      <fileset file="../configuration/firefox/install.rdf"/>
      <filterset refid="filters"/>
    </copy>
	</target>

  <!-- Builds the content JavaScript for Firefox -->
  <target name="build.firefox.content">
    <echo level="info" message="Building the content JavaScript"/>
    <concat destfile="firefox/content/web-developer/content/content.js">
      <fileset file="../source/common/javascript/common/common.js"/>
      <fileset file="../source/firefox/javascript/common/common.js"/>
      <fileset file="../source/common/javascript/common/css.js"/>
      <fileset file="../source/common/javascript/content/content.js"/>
      <fileset file="../source/firefox/javascript/content/content.js"/>
    </concat>
  </target>

  <!-- Builds the dashboard for Firefox -->
  <target name="build.firefox.dashboard">
    <echo level="info" message="Building the dashboard"/>
    <copy todir="firefox/content/web-developer/dashboard">
      <fileset dir="../source/firefox/html/dashboard"/>
      <filterset refid="filters"/>
    </copy>
    <copy todir="firefox/content/web-developer/dashboard">
      <fileset dir="../source/firefox/xul/dashboard"/>
    </copy>
    <concat destfile="firefox/content/web-developer/dashboard/javascript/dashboard.js">
    	<fileset file="../source/common/javascript/dashboard/dashboard.js"/>
    	<fileset file="../source/firefox/javascript/dashboard/dashboard.js"/>
    </concat>
    <concat destfile="firefox/content/web-developer/dashboard/javascript/element-information.js">
    	<fileset file="../source/common/javascript/dashboard/element-information.js"/>
    	<fileset file="../source/firefox/javascript/dashboard/element-information.js"/>
    </concat>
    <copy file="../source/firefox/javascript/dashboard/style-information.js" tofile="firefox/content/web-developer/dashboard/javascript/style-information.js"/>
    <copy file="../source/firefox/javascript/dashboard/edit-html.js" tofile="firefox/content/web-developer/dashboard/javascript/edit-html.js"/>
    <concat destfile="firefox/content/web-developer/dashboard/javascript/edit-css.js">
    	<fileset file="../source/common/javascript/dashboard/edit-css.js"/>
    	<fileset file="../source/firefox/javascript/dashboard/edit-css.js"/>
    </concat>
    <copy todir="firefox/content/web-developer/dashboard/javascript/html">
      <fileset dir="../source/firefox/javascript/dashboard/html">
     		<exclude name="common.js"/>
      </fileset>
    </copy>
    <concat destfile="firefox/content/web-developer/dashboard/javascript/html/common.js">
    	<fileset file="../source/common/javascript/generated/common.js"/>
    	<fileset file="../source/firefox/javascript/dashboard/html/common.js"/>
    </concat>
  	<copy file="../source/common/javascript/toolbar/html/element-ancestors.js" tofile="firefox/content/web-developer/dashboard/javascript/html/element-ancestors.js"/>
    <concat destfile="firefox/content/web-developer/dashboard/common.css">
    	<fileset file="../source/common/style-sheets/dashboard/common.css"/>
    	<fileset file="../source/firefox/style-sheets/dashboard/html/common.css"/>
    </concat>
    <copy file="../source/firefox/style-sheets/dashboard/dashboard.css" tofile="firefox/content/web-developer/dashboard/dashboard.css"/>
    <concat destfile="firefox/content/web-developer/dashboard/element-information.css">
    	<fileset file="../source/common/style-sheets/dashboard/element-information.css"/>
    	<fileset file="../source/firefox/style-sheets/dashboard/html/element-information.css"/>
    </concat>
    <concat destfile="firefox/content/web-developer/dashboard/style-information.css">
    	<fileset file="../source/common/style-sheets/generated/common.css"/>
    	<fileset file="../source/firefox/style-sheets/dashboard/html/style-information.css"/>
    </concat>
	</target>

  <!-- Builds the dialogs for Firefox -->
  <target name="build.firefox.dialogs">
    <echo level="info" message="Building the dialogs"/>
    <copy todir="firefox/content/web-developer/dialogs">
      <fileset dir="../source/firefox/xul/dialogs"/>
    </copy>
    <copy todir="firefox/content/web-developer/dialogs/javascript">
      <fileset dir="../source/firefox/javascript/dialogs">
     		<exclude name="dialogs.js"/>
      </fileset>
    </copy>
    <copy todir="firefox/content/web-developer/dialogs/style-sheets">
      <fileset dir="../source/firefox/style-sheets/dialogs"/>
    </copy>
	</target>

  <!-- Builds the features for Firefox -->
  <target name="build.firefox.features">
    <echo level="info" message="Building the features"/>
    <copy todir="firefox/content/web-developer/features/style-sheets">
      <fileset dir="../source/common/style-sheets/features"/>
      <fileset dir="../source/firefox/style-sheets/features"/>
    </copy>
    <copy file="../source/common/style-sheets/common/reset.css" tofile="firefox/content/web-developer/features/style-sheets/css/disable-browser-default-styles.css"/>
    <copy file="../images/common/transparent.png" tofile="firefox/content/web-developer/features/style-sheets/images/transparent.png"/>
    <copy todir="firefox/content/web-developer/validation">
      <fileset dir="../source/firefox/html/validation"/>
      <filterset refid="filters"/>
    </copy>
	</target>

  <!-- Builds the generated pages for Firefox -->
  <target name="build.firefox.generated">
    <echo level="info" message="Building the generated pages"/>
    <copy todir="firefox/content/web-developer/generated">
      <fileset dir="../source/common/html/generated"/>
      <fileset dir="../source/firefox/html/generated"/>
      <fileset dir="../source/common/style-sheets/generated">
        <exclude name="common.css"/>
      </fileset>
      <fileset dir="../source/firefox/style-sheets/generated"/>
      <filterset refid="filters"/>
    </copy>
    <copy file="../source/common/javascript/generated/beautify/beautify.js" tofile="firefox/content/web-developer/generated/javascript/beautify/beautify.js"/>
    <copy todir="firefox/content/web-developer/generated/javascript">
      <fileset dir="../source/common/javascript/generated">
        <exclude name="view-cookie-information.js"/>
      </fileset>
      <fileset dir="../source/firefox/javascript/generated"/>
    </copy>
    <concat destfile="firefox/content/web-developer/generated/javascript/view-cookie-information.js">
      <fileset file="../source/common/javascript/generated/view-cookie-information.js"/>
      <fileset file="../source/firefox/javascript/preferences/preferences.js"/>
    </concat>
	</target>

  <!-- Builds the locales for Firefox -->
  <target name="build.firefox.locales">
    <echo level="info" message="Building the locales"/>
    <copy todir="firefox/locale">
      <fileset dir="../source/firefox/locales"/>
      <filterset refid="filters"/>
    </copy>
	</target>

  <!-- Builds the options for Firefox -->
  <target name="build.firefox.options">
    <echo level="info" message="Building the options"/>
    <copy todir="firefox/content/web-developer/options">
      <fileset dir="../source/firefox/xul/options"/>
    </copy>
    <copy file="../source/common/html/options/syntax-highlight.html" tofile="firefox/content/web-developer/options/html/syntax-highlight.html">
      <filterset refid="filters"/>
    </copy>
    <copy file="../source/firefox/javascript/options/options.js" tofile="firefox/content/web-developer/options/javascript/options.js"/>
    <copy todir="firefox/content/web-developer/options/dialogs/javascript">
      <fileset dir="../source/firefox/javascript/options/dialogs"/>
    </copy>
    <copy file="../source/common/javascript/options/syntax-highlight.js" tofile="firefox/content/web-developer/options/html/javascript/syntax-highlight.js"/>
    <copy file="../source/firefox/style-sheets/options/options.css" tofile="firefox/content/web-developer/options/style-sheets/options.css"/>
    <copy file="../source/common/style-sheets/options/syntax-highlight.css" tofile="firefox/content/web-developer/options/html/syntax-highlight.css"/>
	</target>

  <!-- Builds the overlay for Firefox -->
  <target name="build.firefox.overlay">
    <echo level="info" message="Building the overlay"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="cookies"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.cookies" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="css"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.css" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="disable"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.disable" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="forms"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.forms" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="images"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.images" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="information"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.information" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="miscellaneous"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.miscellaneous" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="options"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.options" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="outline"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.outline" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="resize"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.resize" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="tools"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.tools" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="view-source"/>
    	<param name="menu.suffix" value="app-menu"/>
  	</antcallback>
		<property name="app.menu.view.source" value="${menu}"/>
  	<var name="menu" unset="true"/>

  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="cookies"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.cookies" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="css"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.css" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="disable"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.disable" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="forms"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.forms" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="images"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.images" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="information"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.information" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="miscellaneous"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.miscellaneous" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="options"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.options" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="outline"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.outline" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="resize"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.resize" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="tools"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.tools" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="view-source"/>
    	<param name="menu.suffix" value="context"/>
  	</antcallback>
		<property name="context.view.source" value="${menu}"/>
  	<var name="menu" unset="true"/>

  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="cookies"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.cookies" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="css"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.css" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="disable"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.disable" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="forms"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.forms" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="images"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.images" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="information"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.information" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="miscellaneous"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.miscellaneous" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="options"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.options" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="outline"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.outline" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="resize"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.resize" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="tools"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.tools" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="view-source"/>
    	<param name="menu.suffix" value="menu"/>
  	</antcallback>
		<property name="menu.view.source" value="${menu}"/>
  	<var name="menu" unset="true"/>

		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="cookies"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.cookies" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="css"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.css" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="disable"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.disable" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="forms"/>
			<param name="seamonkey.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.forms" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="images"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.images" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="information"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.information" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="miscellaneous"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.miscellaneous" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="options"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.options" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="outline"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.outline" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="resize"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.resize" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="tools"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.tools" value="${menu}"/>
		<var name="menu" unset="true"/>
		<antcallback target="build.firefox.overlay.menu" return="menu">
			<param name="menu.name" value="view-source"/>
			<param name="menu.suffix" value="seamonkey"/>
		</antcallback>
		<property name="seamonkey.view.source" value="${menu}"/>
		<var name="menu" unset="true"/>

  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="cookies"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.cookies" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="css"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.css" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="disable"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.disable" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="forms"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.forms" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="images"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.images" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="information"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.information" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="miscellaneous"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.miscellaneous" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="options"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.options" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="outline"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.outline" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="resize"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.resize" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="tools"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.tools" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="view-source"/>
    	<param name="menu.suffix" value="toolbar"/>
  	</antcallback>
		<property name="toolbar.view.source" value="${menu}"/>
  	<var name="menu" unset="true"/>

  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="cookies"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.cookies" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="css"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.css" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="disable"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.disable" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="forms"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.forms" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="images"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.images" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="information"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.information" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="miscellaneous"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.miscellaneous" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="options"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.options" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="outline"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.outline" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="resize"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.resize" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="tools"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.tools" value="${menu}"/>
  	<var name="menu" unset="true"/>
  	<antcallback target="build.firefox.overlay.menu" return="menu">
    	<param name="menu.name" value="view-source"/>
    	<param name="menu.suffix" value="toolbar-buttton"/>
  	</antcallback>
		<property name="toolbar.button.view.source" value="${menu}"/>
  	<var name="menu" unset="true"/>

    <copy file="../source/firefox/xul/overlay/overlay.xul" tofile="firefox/content/web-developer/overlay/overlay.xul">
		  <filterchain>
		    <expandproperties/>
		  </filterchain>
    </copy>

    <concat destfile="firefox/content/web-developer/overlay/javascript/overlay.temp">
      <fileset dir="../source/common/javascript/features"/>
      <fileset dir="../source/common/javascript/overlay"/>
    	<fileset dir="../source/common/javascript/toolbar">
     		<exclude name="**/html/**"/>
    	</fileset>
      <fileset dir="../source/common/javascript/upgrade"/>
      <fileset dir="../source/firefox/javascript/application"/>
      <fileset dir="../source/firefox/javascript/features"/>
      <fileset dir="../source/firefox/javascript/overlay"/>
    	<fileset dir="../source/firefox/javascript/toolbar"/>
      <fileset dir="../source/firefox/javascript/upgrade"/>
      <fileset dir="../source/firefox/javascript/validation"/>
    </concat>
    <move file="firefox/content/web-developer/overlay/javascript/overlay.temp" tofile="firefox/content/web-developer/overlay/javascript/overlay.js">
      <filterset refid="filters"/>
    </move>
    <copy file="../source/firefox/style-sheets/overlay/overlay.css" tofile="firefox/content/web-developer/overlay/style-sheets/overlay.css"/>
	</target>

  <!-- Builds the overlay menu for Firefox -->
  <target name="build.firefox.overlay.menu">
  	<property name="suffix" value="${menu.suffix}"/>
		<loadfile property="menu" srcFile="../source/firefox/xul/overlay/menus/${menu.name}.xul">
		  <filterchain>
		    <expandproperties/>
		  </filterchain>
		</loadfile>
 	</target>

  <!-- Builds the skins for Firefox -->
  <target name="build.firefox.skins">
    <echo level="info" message="Building the skins"/>
    <copy file="../source/firefox/style-sheets/skin/common.css" tofile="firefox/skin/default/web-developer.css"/>
    <concat destfile="firefox/skin/mac/web-developer.css">
    	<fileset file="../source/firefox/style-sheets/skin/common.css"/>
    	<fileset file="../source/firefox/style-sheets/skin/mac.css"/>
    </concat>
    <copy todir="firefox/skin">
      <fileset dir="../images/firefox/skins"/>
    </copy>
    <copy file="../images/common/logos/16.png" tofile="firefox/skin/default/button.png"/>
    <copy file="../images/common/logos/16.png" tofile="firefox/skin/default/menu.png"/>
    <copy file="../images/common/logos/16.png" tofile="firefox/skin/mac/color/button.png"/>
    <copy file="../images/common/logos/16.png" tofile="firefox/skin/mac/color/menu.png"/>
    <copy file="../images/common/logos/32.png" tofile="firefox/skin/default/button-2x.png"/>
    <copy file="../images/common/logos/32.png" tofile="firefox/skin/default/menu-2x.png"/>
    <copy file="../images/common/logos/32.png" tofile="firefox/skin/mac/color/button-2x.png"/>
    <copy file="../images/common/logos/32.png" tofile="firefox/skin/mac/color/menu-2x.png"/>
    <copy file="../images/common/toolbar.png" tofile="firefox/skin/default/toolbar.png"/>
    <copy file="../images/common/toolbar-2x.png" tofile="firefox/skin/default/toolbar-2x.png"/>
    <copy file="../images/common/logos/monochrome/16.png" tofile="firefox/skin/mac/button.png"/>
    <copy file="../images/common/logos/monochrome/32.png" tofile="firefox/skin/mac/button-2x.png"/>
    <copy file="../images/common/toolbar.png" tofile="firefox/skin/mac/color/toolbar.png"/>
    <copy file="../images/common/toolbar-2x.png" tofile="firefox/skin/mac/color/toolbar-2x.png"/>
    <copy file="../images/firefox/skins/default/options.png" tofile="firefox/skin/mac/options.png"/>
    <copy file="../images/firefox/skins/default/options-2x.png" tofile="firefox/skin/mac/options-2x.png"/>
    <copy todir="firefox/skin/mac/color">
      <fileset dir="../images/firefox/skins/default">
     		<exclude name="options.png"/>
        <exclude name="options-2x.png"/>
      </fileset>
    </copy>
	</target>

  <!-- Builds the toolbars for Firefox -->
  <target name="build.firefox.toolbars">
    <echo level="info" message="Building the toolbars"/>
    <copy file="../source/firefox/html/toolbar/element-ancestors.html" tofile="firefox/content/web-developer/toolbar/html/element-ancestors.html">
    	<filterset refid="filters"/>
    </copy>
   	<concat destfile="firefox/content/web-developer/toolbar/html/javascript/element-ancestors.js">
    	<fileset file="../source/common/javascript/generated/common.js"/>
    	<fileset file="../source/common/javascript/toolbar/html/element-ancestors.js"/>
    </concat>
    <copy file="../source/common/style-sheets/toolbar/element-ancestors.css" tofile="firefox/content/web-developer/toolbar/html/element-ancestors.css"/>
    <copy todir="firefox/content/web-developer/toolbar">
      <fileset dir="../source/common/style-sheets/toolbar"/>
    </copy>
	</target>

  <!-- Builds the configuration for Opera -->
  <target name="build.opera.configuration" depends="initialize.opera">
    <echo level="info" message="Building the configuration"/>
    <copy file="../configuration/opera/manifest.json" tofile="opera/manifest.json">
      <filterset refid="filters"/>
    </copy>
  </target>

  <!-- Clean targets -->
  <target name="clean.chrome">
    <echo level="info" message="Cleaning up the build for Chrome"/>
  	<delete dir="chrome"/>
  	<delete file="web-developer-chrome.zip"/>
  </target>

  <target name="clean.firefox">
    <echo level="info" message="Cleaning up the build for Firefox"/>
  	<delete dir="firefox"/>
  	<delete file="web-developer-firefox.xpi"/>
  </target>

  <target name="clean.opera">
    <echo level="info" message="Cleaning up the build for Opera"/>
    <delete dir="opera"/>
    <delete file="web-developer-opera.nex"/>
  </target>

  <!-- Converts tabs to spaces in the extension -->
  <target name="convert.tabs.spaces">
    <echo level="info" message="Converting tabs to spaces"/>
		<fixcrlf srcdir="../source/chrome/javascript" excludes="**/jquery/tablednd.js" tab="remove" tablength="2"/>
		<fixcrlf srcdir="../source/common/javascript" excludes="**/beautify/beautify.js,**/bootstrap/collapse.js,**/bootstrap/dropdown.js,**/bootstrap/modal.js,**/bootstrap/tab.js,**/bootstrap/transition.js,**/codemirror/codemirror.js,**/codemirror/css.js,**/codemirror/htmlmixed.js,**/codemirror/javascript.js,**/codemirror/searchcursor.js,**/jquery/icanhaz.js,**/jquery/jquery.js,**/codemirror/xml.js" tab="remove" tablength="2"/>
		<fixcrlf srcdir="../source/firefox/javascript" tab="remove" tablength="2"/>
 	</target>

  <!-- Initialize targets -->
  <target name="initialize">
    <tstamp>
      <format property="build.date" pattern="MMMM d, yyyy"/>
    </tstamp>
  </target>

  <target name="initialize.chrome" depends="initialize">
    <echo level="info" message="Building the extension for Chrome"/>
    <var name="browser" value="chrome"/>
    <filterset id="filters">
      <filter token="browser" value="${browser}"/>
      <filter token="build.date" value="${build.date}"/>
      <filtersfile file="../configuration/common/configuration.properties"/>
      <filtersfile file="../configuration/chrome/configuration.properties"/>
    </filterset>
	</target>

  <target name="initialize.firefox" depends="initialize">
    <echo level="info" message="Building the extension for Firefox"/>
    <var name="browser" value="firefox"/>
    <filterset id="filters">
      <filter token="browser" value="${browser}"/>
      <filter token="build.date" value="${build.date}"/>
      <filtersfile file="../configuration/common/configuration.properties"/>
      <filtersfile file="../configuration/firefox/configuration.properties"/>
    </filterset>
	</target>

  <target name="initialize.opera" depends="initialize">
    <echo level="info" message="Building the extension for Opera"/>
    <var name="browser" value="opera"/>
    <filterset id="filters">
      <filter token="browser" value="${browser}"/>
      <filter token="build.date" value="${build.date}"/>
      <filtersfile file="../configuration/common/configuration.properties"/>
      <filtersfile file="../configuration/opera/configuration.properties"/>
    </filterset>
  </target>

  <!-- Installs the extension in Firefox using the Extension Auto-Installer extension on port 9999 and wget -->
  <target name="install.firefox" depends="package.firefox">
    <echo level="info" message="Installing the extension for Firefox"/>
		<exec executable="wget">
		  <arg line="-q --post-file=web-developer-firefox.xpi http://localhost:9999/"/>
		</exec>
	</target>

  <!-- Runs JSHint on the extension -->
  <target name="jshint" depends="convert.tabs.spaces">
    <echo level="info" message="Running JSHint"/>
    <property name="jshint.globals" value="$:true,BrowserPageInfo:true,BrowserReload:true,BrowserViewSourceOfDocument:true,chrome:true,CodeMirror:true,Components:true,CSSPrimitiveValue:true,gDevToolsBrowser:true,getWebNavigation:true,HTMLDocument:true,ich:true,inspectDOMDocument:true,js_beautify:true,Node:true,NodeFilter:true,pref:true,toJavaScriptConsole:true,WebDeveloper:true,WebDeveloperApplication:true,WebDeveloperValidateCSS:true,WebDeveloperValidateHTML:true"/>
    <property name="jshint.options" value="bitwise:false,eqeqeq:false,forin:false,plusplus:false,strict:false"/>
    <jshint dir="../source/chrome/javascript" excludes="**/jquery/tablednd.js" fail="false" globals="${jshint.globals}" options="${jshint.options}"/>
    <jshint dir="../source/common/javascript" excludes="**/beautify/beautify.js,**/bootstrap/collapse.js,**/bootstrap/dropdown.js,**/bootstrap/modal.js,**/bootstrap/popover.js,**/bootstrap/tab.js,**/bootstrap/tooltip.js,**/bootstrap/transition.js,**/codemirror/codemirror.js,**/codemirror/css.js,**/codemirror/htmlmixed.js,**/codemirror/javascript.js,**/codemirror/searchcursor.js,**/jquery/icanhaz.js,**/jquery/jquery.js,**/codemirror/xml.js" fail="false" globals="${jshint.globals}" options="${jshint.options}"/>
    <jshint dir="../source/firefox/javascript" fail="false" globals="${jshint.globals}" options="${jshint.options}"/>
    <echo level="info" message="Result should be 27 errors"/>
  </target>

  <!-- Runs JSLint on the extension -->
  <target name="jslint" depends="convert.tabs.spaces">
    <echo level="info" message="Running JSLint"/>
    <jslint haltOnFailure="false" options="browser,forin,indent=2,maxerr=100,undef">
      <formatter type="plain"/>
      <predef>$$,BrowserPageInfo,BrowserReload,BrowserViewSourceOfDocument,chrome,CodeMirror,Components,CSSPrimitiveValue,gDevToolsBrowser,getWebNavigation,HTMLDocument,ich,Image,inspectDOMDocument,js_beautify,Node,NodeFilter,pref,toJavaScriptConsole,WebDeveloper,WebDeveloperApplication,WebDeveloperValidateCSS,WebDeveloperValidateHTML,window</predef>
      <fileset dir="../source/chrome/javascript" excludes="**/jquery/tablednd.js"/>
      <fileset dir="../source/common/javascript" excludes="**/beautify/beautify.js,**/bootstrap/collapse.js,**/bootstrap/dropdown.js,**/bootstrap/modal.js,**/bootstrap/popover.js,**/bootstrap/tab.js,**/bootstrap/tooltip.js,**/bootstrap/transition.js,**/codemirror/codemirror.js,**/codemirror/css.js,**/codemirror/htmlmixed.js,**/codemirror/javascript.js,**/codemirror/searchcursor.js,**/jquery/icanhaz.js,**/jquery/jquery.js,**/codemirror/xml.js"/>
      <fileset dir="../source/firefox/javascript"/>
    </jslint>
    <echo level="info" message="Result should be 27 errors in 9 files"/>
  </target>

  <!-- Merges in Bootstrap -->
  <target name="merge.bootstrap">
    <echo level="info" message="Merging Bootstrap into the source"/>
    <copy file="../merge/bootstrap/dist/css/bootstrap.css" tofile="../source/common/style-sheets/common/bootstrap/bootstrap.css"/>
		<copy file="../merge/bootstrap/js/collapse.js" tofile="../source/common/javascript/common/bootstrap/collapse.js"/>
		<copy file="../merge/bootstrap/js/dropdown.js" tofile="../source/common/javascript/common/bootstrap/dropdown.js"/>
		<copy file="../merge/bootstrap/js/modal.js" tofile="../source/common/javascript/common/bootstrap/modal.js"/>
		<copy file="../merge/bootstrap/js/popover.js" tofile="../source/common/javascript/common/bootstrap/popover.js"/>
		<copy file="../merge/bootstrap/js/tab.js" tofile="../source/common/javascript/common/bootstrap/tab.js"/>
		<copy file="../merge/bootstrap/js/tooltip.js" tofile="../source/common/javascript/common/bootstrap/tooltip.js"/>
		<copy file="../merge/bootstrap/js/transition.js" tofile="../source/common/javascript/common/bootstrap/transition.js"/>
  </target>

  <!-- Merges in CodeMirror -->
  <target name="merge.codemirror">
    <echo level="info" message="Merging CodeMirror into the source"/>
		<copy todir="../source/common/javascript/common/codemirror">
    	<fileset file="../merge/codemirror/lib/codemirror.js"/>
    	<fileset file="../merge/codemirror/lib/util/searchcursor.js"/>
    	<fileset file="../merge/codemirror/mode/css/css.js"/>
    	<fileset file="../merge/codemirror/mode/htmlmixed/htmlmixed.js"/>
    	<fileset file="../merge/codemirror/mode/javascript/javascript.js"/>
    	<fileset file="../merge/codemirror/mode/xml/xml.js"/>
    </copy>
		<copy file="../merge/codemirror/lib/codemirror.css" tofile="../source/common/style-sheets/common/codemirror/codemirror.css"/>
  </target>

  <!-- Merges in Font Awesome -->
  <target name="merge.fontawesome">
    <echo level="info" message="Merging Font Awesome into the source"/>
		<copy file="../merge/font-awesome/css/font-awesome.css" tofile="../source/common/style-sheets/common/bootstrap/font-awesome.css"/>
    <copy todir="../source/common/fonts">
      <fileset dir="../merge/font-awesome/font">
        <exclude name="FontAwesome.otf"/>
      </fileset>
    </copy>
  </target>

  <!-- Package targets -->
  <target name="package.chrome" depends="build.chrome" description="Packages the extension for Chrome">
    <echo level="info" message="Packaging the extension for Chrome"/>
    <zip destfile="web-developer-chrome.zip" level="1">
      <zipfileset dir="chrome"/>
      <zipfileset file="license.txt"/>
    </zip>
  </target>

  <target name="package.firefox" depends="build.firefox" description="Packages the extension for Firefox">
    <echo level="info" message="Packaging the extension for Firefox"/>
    <zip destfile="web-developer-firefox.xpi" level="1">
      <zipfileset dir="firefox"/>
      <zipfileset file="license.txt"/>
    </zip>
  </target>

  <target name="package.opera" depends="build.opera" description="Packages the extension for Opera">
    <echo level="info" message="Packaging the extension for Opera"/>
    <zip destfile="web-developer-opera.nex" level="1">
      <zipfileset dir="opera"/>
      <zipfileset file="license.txt"/>
    </zip>
  </target>
</project>
